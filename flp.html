<div class="scenario-card">
            <h3>ìƒí™©: ì¤‘êµ­ì§‘ì—ì„œ 10ëª…ì´ 15ì´ˆ ë‚´ì— í•˜ë‚˜ì˜ ë©”ë‰´ë¡œ í•©ì˜í•´ì•¼ í•©ë‹ˆë‹¤</h3>
            <div class="menu-options">
                <div class="menu-option" id="menu-jjajang">ğŸœ ì§œì¥ë©´</div>
                <div class="menu-option" id="menu-jjamppong">ğŸ² ì§¬ë½•</div>
                <div class="menu-option" id="menu-bokkeumbap">ğŸš ë³¶ìŒë°¥</div>
                <div class="menu-option" id="menu-tangsuyuk">ğŸ¤ íƒ•ìˆ˜ìœ¡</div>
            </div>
            <p><strong>ì œí•œ ì¡°ê±´:</strong> â° 15ì´ˆ ì‹œê°„ ì œí•œ | ğŸ”§ 10ëª… ì¤‘ ëœë¤í•˜ê²Œ 1ëª… ì¥ì•  ë°œìƒ | ğŸ“¨ ë‚˜ë¨¸ì§€ 9ëª…ì€ ëª¨ë‘ ì°¬ì„± (ë°˜ëŒ€ ì—†ìŒ)</p>
            <p><strong>í•©ì˜ ê³¼ì •:</strong> 1) ëˆ„êµ°ê°€ ë©”ë‰´ë¥¼ ì œì•ˆ â†’ 2) ëª¨ë“  ì‚¬ëŒì—ê²Œ ë©”ì‹œì§€ ì „ì†¡ â†’ 3) ì°¬ì„± íˆ¬í‘œë§Œ (ë°˜ëŒ€ ì—†<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FLP ì •ë¦¬: ì¤‘êµ­ì§‘ ë©”ë‰´ í•©ì˜</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        h1 {
            text-align: center;
            margin-bottom: 30px;
            font-size: 28px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .scenario-card {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(15px);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            text-align: center;
        }

        .menu-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .menu-option {
            background: rgba(255, 255, 255, 0.2);
            padding: 15px;
            border-radius: 15px;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .menu-option:hover {
            transform: scale(1.05);
            background: rgba(255, 255, 255, 0.3);
        }

        .current-proposal {
            background: rgba(255, 193, 7, 0.4);
            border: 3px solid #FFD700;
            animation: proposal-highlight 2s infinite;
        }

        @keyframes proposal-highlight {
            0%, 100% { box-shadow: 0 0 10px rgba(255, 215, 0, 0.5); }
            50% { box-shadow: 0 0 20px rgba(255, 215, 0, 0.8); }
        }

        .controls {
            text-align: center;
            margin: 30px 0;
        }

        .control-btn {
            background: linear-gradient(45deg, #00d4ff, #5a67d8);
            color: white;
            border: none;
            padding: 12px 25px;
            margin: 0 10px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .control-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 212, 255, 0.4);
        }

        .control-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .proposal-section {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 25px;
            margin: 20px 0;
            text-align: center;
        }

        .proposer-info {
            font-size: 18px;
            margin-bottom: 15px;
            color: #FFD700;
        }

        .current-proposal-display {
            font-size: 24px;
            font-weight: bold;
            background: rgba(255, 193, 7, 0.3);
            padding: 15px 25px;
            border-radius: 15px;
            margin: 15px 0;
        }

        .simulation-area {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 30px;
            margin: 30px 0;
            min-height: 600px;
            position: relative;
        }

        .people-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            grid-template-rows: repeat(2, 1fr);
            gap: 20px;
            height: 400px;
            margin-bottom: 30px;
        }

        .person {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 15px;
            padding: 15px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            transition: all 0.5s ease;
            position: relative;
        }

        .person-avatar {
            width: 50px;
            height: 50px;
            background: linear-gradient(45deg, #4CAF50, #45a049);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            margin-bottom: 10px;
        }

        .person-name {
            font-size: 12px;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .person-status {
            font-size: 11px;
            opacity: 0.8;
            text-align: center;
            min-height: 20px;
        }

        .person-vote {
            margin-top: 8px;
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 11px;
            font-weight: bold;
        }

        .vote-agree {
            background: rgba(0, 255, 136, 0.7);
            color: #333;
        }

        .vote-disagree {
            background: rgba(255, 107, 107, 0.7);
            color: white;
        }

        .person.proposer {
            border: 3px solid #FFD700;
            background: rgba(255, 215, 0, 0.2);
        }

        .person.proposer .person-avatar {
            background: linear-gradient(45deg, #FFD700, #FFA500);
        }

        .person.thinking {
            animation: thinking-pulse 2s infinite;
        }

        .person.failed {
            background: rgba(255, 107, 107, 0.3);
            border: 2px solid #ff6b6b;
        }

        .person.failed .person-avatar {
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            animation: error-shake 1s infinite;
        }

        @keyframes thinking-pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        @keyframes error-shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-2px); }
            75% { transform: translateX(2px); }
        }

        .message-lines {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 10;
        }

        .message-line {
            position: absolute;
            height: 2px;
            background: linear-gradient(90deg, #00d4ff, transparent);
            opacity: 0;
            animation: message-flow 2s ease-in-out;
        }

        @keyframes message-flow {
            0% { opacity: 0; width: 0; }
            50% { opacity: 1; width: 150px; }
            100% { opacity: 0; width: 150px; }
        }

        .message-bubble {
            position: absolute;
            background: rgba(0, 212, 255, 0.9);
            color: white;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 10px;
            font-weight: bold;
            opacity: 0;
            animation: message-bubble 3s ease-in-out;
            z-index: 20;
        }

        @keyframes message-bubble {
            0% { opacity: 0; transform: scale(0); }
            30% { opacity: 1; transform: scale(1); }
            70% { opacity: 1; transform: scale(1); }
            100% { opacity: 0; transform: scale(0); }
        }

        .status-panel {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
        }

        .status-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-size: 14px;
        }

        .timer {
            text-align: center;
            font-size: 24px;
            font-weight: bold;
            color: #FFD700;
            margin: 20px 0;
        }

        .consensus-bar {
            width: 100%;
            height: 30px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 15px;
            margin: 15px 0;
            overflow: hidden;
            display: flex;
        }

        .agree-bar {
            background: linear-gradient(45deg, #00ff88, #00cc6a);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
            color: white;
            transition: width 0.5s ease;
        }

        .disagree-bar {
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
            color: white;
            transition: width 0.5s ease;
        }

        .phase-indicator {
            text-align: center;
            font-size: 18px;
            font-weight: bold;
            margin: 20px 0;
            padding: 15px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
        }

        .final-result {
            text-align: center;
            font-size: 20px;
            font-weight: bold;
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            display: none;
        }

        .result-success {
            background: rgba(0, 255, 136, 0.2);
            color: #00ff88;
        }

        .result-timeout {
            background: rgba(255, 107, 107, 0.2);
            color: #ff6b6b;
        }

        .result-failed {
            background: rgba(255, 193, 7, 0.2);
            color: #FFD700;
        }

        .explanation-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            border-left: 4px solid #FFD700;
        }

        .voting-process {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
        }

        @media (max-width: 768px) {
            .people-grid {
                grid-template-columns: repeat(3, 1fr);
                grid-template-rows: repeat(4, 1fr);
                gap: 15px;
            }
            
            .menu-options {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¥¢ FLP ì •ë¦¬: ì¤‘êµ­ì§‘ ë©”ë‰´ í•©ì˜ ê³¼ì •</h1>

        <div class="scenario-card">
            <h3>ìƒí™©: ì¤‘êµ­ì§‘ì—ì„œ 10ëª…ì´ 15ì´ˆ ë‚´ì— í•˜ë‚˜ì˜ ë©”ë‰´ë¡œ í•©ì˜í•´ì•¼ í•©ë‹ˆë‹¤</h3>
            <div class="menu-options">
                <div class="menu-option" id="menu-jjajang">ğŸœ ì§œì¥ë©´</div>
                <div class="menu-option" id="menu-jjamppong">ğŸ² ì§¬ë½•</div>
                <div class="menu-option" id="menu-bokkeumbap">ğŸš ë³¶ìŒë°¥</div>
                <div class="menu-option" id="menu-tangsuyuk">ğŸ¤ íƒ•ìˆ˜ìœ¡</div>
            </div>
            <p><strong>ì œí•œ ì¡°ê±´:</strong> â° 15ì´ˆ ì‹œê°„ ì œí•œ | ğŸ”§ ë§¤ ë¼ìš´ë“œë§ˆë‹¤ ëœë¤í•˜ê²Œ 1ëª… ì¥ì•  | ğŸ² ëœë¤ íˆ¬í‘œ ê²°ê³¼</p>
            <p><strong>ê°€ëŠ¥í•œ ì‹œë‚˜ë¦¬ì˜¤:</strong> ì¼ë¶€ ì°¬ì„±+ë°˜ëŒ€+ë¬´ì‘ë‹µ | ë˜ëŠ” 9ëª… ì „ì²´ ì°¬ì„±+1ëª… ì¥ì•  | ê¸°íƒ€ ë‹¤ì–‘í•œ ì¡°í•©</p>
            <p><strong>í•©ì˜ ì¡°ê±´:</strong> ì¥ì• ë¥¼ ì œì™¸í•œ ëª¨ë“  ì‚¬ëŒì´ ì°¬ì„±í•´ì•¼ í•©ì˜ ì„±ê³µ</p>
        </div>

        <div class="proposal-section" id="proposalSection" style="display: none;">
            <div class="proposer-info" id="proposerInfo">
                <!-- ì œì•ˆì ì •ë³´ê°€ ì—¬ê¸° í‘œì‹œë©ë‹ˆë‹¤ -->
            </div>
            <div class="current-proposal-display" id="currentProposal">
                <!-- í˜„ì¬ ì œì•ˆì´ ì—¬ê¸° í‘œì‹œë©ë‹ˆë‹¤ -->
            </div>
        </div>

        <div class="controls">
            <button class="control-btn" id="startBtn" onclick="startSimulation()">í•©ì˜ ê³¼ì • ì‹œì‘</button>
            <button class="control-btn" id="resetBtn" onclick="resetSimulation()">ì´ˆê¸°í™”</button>
            <button class="control-btn" id="nextRoundBtn" onclick="nextRound()" style="display: none;">ë‹¤ìŒ ë¼ìš´ë“œ</button>
        </div>

        <div class="phase-indicator" id="phaseIndicator">
            ğŸ’­ ëŒ€ê¸° ìƒíƒœ: ëˆ„êµ°ê°€ ë©”ë‰´ë¥¼ ì œì•ˆí•  ë•Œê¹Œì§€ ê¸°ë‹¤ë¦¬ê³  ìˆìŠµë‹ˆë‹¤
        </div>

        <div class="timer" id="timer">â° ì œí•œì‹œê°„: 15ì´ˆ | ê²½ê³¼ ì‹œê°„: 00:00</div>

        <div class="simulation-area">
            <div class="message-lines" id="messageLines"></div>
            <div class="people-grid" id="peopleGrid">
                <!-- ì‚¬ëŒë“¤ì´ ë™ì ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤ -->
            </div>

            <div class="consensus-bar">
                <div class="agree-bar" id="agreeBar" style="width: 0%;">ì°¬ì„± 0</div>
                <div class="disagree-bar" id="disagreeBar" style="width: 0%;">ë°˜ëŒ€ 0</div>
            </div>

            <div class="status-panel">
                <div class="status-row">
                    <span>í˜„ì¬ ì œì•ˆ:</span>
                    <span id="currentProposalStatus">ì—†ìŒ</span>
                </div>
                <div class="status-row">
                    <span>ì°¬ì„±:</span>
                    <span id="agreeCount">0ëª…</span>
                </div>
                <div class="status-row">
                    <span>ë°˜ëŒ€:</span>
                    <span id="disagreeCount">0ëª…</span>
                </div>
                <div class="status-row">
                    <span>ì‘ë‹µ ëŒ€ê¸°:</span>
                    <span id="waitingCount">10ëª…</span>
                </div>
                <div class="status-row">
                    <span>ì¥ì•  ë°œìƒ:</span>
                    <span id="failedCount">0ëª…</span>
                </div>
            </div>
        </div>

        <div class="final-result" id="finalResult">
            <!-- ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
        </div>

        <div class="explanation-card">
            <h4>ğŸ¯ FLP ì •ë¦¬ì™€ ë©”ë‰´ í•©ì˜</h4>
            <div class="voting-process">
                <h5>ğŸ“‹ í•©ì˜ ê³¼ì •:</h5>
                <p><strong>1ë‹¨ê³„:</strong> ì œì•ˆìê°€ ë©”ë‰´ ì œì•ˆ (ì˜ˆ: "ì§œì¥ë©´ ì–´ë•Œìš”?")</p>
                <p><strong>2ë‹¨ê³„:</strong> ëª¨ë“  ì°¸ê°€ìì—ê²Œ ë©”ì‹œì§€ ì „ì†¡</p>
                <p><strong>3ë‹¨ê³„:</strong> ê°ì ì°¬ë°˜ ì˜ê²¬ì„ ë©”ì‹œì§€ë¡œ ì‘ë‹µ</p>
                <p><strong>4ë‹¨ê³„:</strong> ì „ì²´ ì°¬ì„± ì‹œ í•©ì˜ ì™„ë£Œ, ì•„ë‹ˆë©´ ë‹¤ë¥¸ ë©”ë‰´ ì œì•ˆ</p>
            </div>
            <p><strong>FLP ë¬¸ì œ:</strong> ì¼ë¶€ê°€ ì‘ë‹µí•˜ì§€ ì•Šê±°ë‚˜ ë°˜ëŒ€í•˜ë©´ ì–¸ì œê¹Œì§€ ê¸°ë‹¤ë ¤ì•¼ í• ì§€ ê²°ì •í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>
            <p><strong>í˜„ì‹¤ì  ë”œë ˆë§ˆ:</strong> "ì°¬ì„± 6ëª…, ë°˜ëŒ€ 2ëª…, ë¬´ì‘ë‹µ 1ëª…... 15ì´ˆê°€ ì§€ë‚¬ëŠ”ë° ì–´ë–»ê²Œ ê²°ì •í•˜ì£ ?"</p>
            <p><strong>í•´ê²°ì±…:</strong> ì‹¤ì œ ë¸”ë¡ì²´ì¸ë“¤ì€ íƒ€ì„ì•„ì›ƒ, í™•ë¥ ì  ë°©ë²•, 2/3 ë‹¤ìˆ˜ê²° ë“±ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.</p>
        </div>
    </div>

    <script>
        let people = [];
        let simulationRunning = false;
        let startTime = 0;
        let timerInterval = null;
        let phase = 'ready';
        let currentProposal = null;
        let proposerIndex = 0;
        let round = 1;

        const names = ['ì•Œë¦¬ìŠ¤', 'ë°¥', 'ì°°ë¦¬', 'ë‹¤ì´ì•ˆ', 'ì´ë¸Œ', 'í”„ë­í¬', 'ê·¸ë ˆì´ìŠ¤', 'í—¨ë¦¬', 'ì•„ì´ë¹„', 'ì­'];
        const menuItems = [
            {id: 'jjajang', name: 'ì§œì¥ë©´', emoji: 'ğŸœ'},
            {id: 'jjamppong', name: 'ì§¬ë½•', emoji: 'ğŸ²'},
            {id: 'bokkeumbap', name: 'ë³¶ìŒë°¥', emoji: 'ğŸš'},
            {id: 'tangsuyuk', name: 'íƒ•ìˆ˜ìœ¡', emoji: 'ğŸ¤'}
        ];

        const phases = {
            ready: 'ğŸ’­ ëŒ€ê¸° ìƒíƒœ: ëˆ„êµ°ê°€ ë©”ë‰´ë¥¼ ì œì•ˆí•  ë•Œê¹Œì§€ ê¸°ë‹¤ë¦¬ê³  ìˆìŠµë‹ˆë‹¤',
            proposing: 'ğŸ“¢ ì œì•ˆ ì¤‘: ë©”ë‰´ê°€ ì œì•ˆë˜ì–´ ëª¨ë“  ì°¸ê°€ìì—ê²Œ ë©”ì‹œì§€ë¥¼ ì „ì†¡í•˜ê³  ìˆìŠµë‹ˆë‹¤',
            voting: 'ğŸ—³ï¸ íˆ¬í‘œ ì¤‘: ê°ì ì œì•ˆëœ ë©”ë‰´ì— ëŒ€í•´ ì°¬ë°˜ ì˜ê²¬ì„ ë³´ë‚´ê³  ìˆìŠµë‹ˆë‹¤',
            waiting: 'â³ ì‘ë‹µ ëŒ€ê¸°: ì¼ë¶€ê°€ ì‘ë‹µí•˜ì§€ ì•Šì•„ í•©ì˜ë¥¼ ì§„í–‰í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤',
            consensus_success: 'âœ… í•©ì˜ ì„±ê³µ: ëª¨ë“  ì°¸ê°€ìê°€ ë™ì¼í•œ ë©”ë‰´ì— ë™ì˜í–ˆìŠµë‹ˆë‹¤',
            consensus_failed: 'âŒ í•©ì˜ ì‹¤íŒ¨: ë°˜ëŒ€ ì˜ê²¬ìœ¼ë¡œ ì¸í•´ ë‹¤ë¥¸ ë©”ë‰´ë¥¼ ì œì•ˆí•´ì•¼ í•©ë‹ˆë‹¤',
            timeout: 'â° ì‹œê°„ ì´ˆê³¼: ì •í•´ì§„ ì‹œê°„ ë‚´ì— ëª¨ë“  ì‘ë‹µì„ ë°›ì§€ ëª»í–ˆìŠµë‹ˆë‹¤'
        };

        function initializePeople() {
            const grid = document.getElementById('peopleGrid');
            grid.innerHTML = '';
            people = [];

            // ë§¤ ë¼ìš´ë“œë§ˆë‹¤ ìƒˆë¡œìš´ ëœë¤ ì¥ì•  ë…¸ë“œ ì„ íƒ
            const failedNodeIndex = Math.floor(Math.random() * 10);

            // ì‹œë‚˜ë¦¬ì˜¤ íƒ€ì… ëœë¤ ê²°ì •
            const scenarioType = Math.random();
            let scenario;
            
            if (scenarioType < 0.3) {
                scenario = 'unanimous'; // 30% í™•ë¥ : 9ëª… ì „ì²´ ì°¬ì„±
            } else if (scenarioType < 0.6) {
                scenario = 'mixed_responses'; // 30% í™•ë¥ : ì¼ë¶€ ì°¬ì„±+ë°˜ëŒ€+ë¬´ì‘ë‹µ
            } else {
                scenario = 'split_vote'; // 40% í™•ë¥ : ì°¬ì„±+ë°˜ëŒ€ í˜¼ì¬
            }

            for (let i = 0; i < 10; i++) {
                const person = {
                    id: i,
                    name: names[i],
                    vote: null,
                    status: 'waiting',
                    responseTime: Math.random() * 12000 + 1000, // 1-13ì´ˆ
                    failed: i === failedNodeIndex,
                    preference: menuItems[Math.floor(Math.random() * menuItems.length)].id,
                    scenario: scenario,
                    willRespond: true,
                    voteDecision: 'agree' // ê¸°ë³¸ê°’
                };

                // ì¥ì•  ë…¸ë“œëŠ” ì‘ë‹µí•˜ì§€ ì•ŠìŒ
                if (person.failed) {
                    person.responseTime = Infinity;
                    person.willRespond = false;
                }

                // ì‹œë‚˜ë¦¬ì˜¤ë³„ íˆ¬í‘œ í–‰ë™ ê²°ì •
                if (!person.failed) {
                    switch (scenario) {
                        case 'unanimous':
                            // ëª¨ë“  ì •ìƒ ë…¸ë“œê°€ ì°¬ì„±
                            person.voteDecision = 'agree';
                            person.willRespond = true;
                            break;
                            
                        case 'mixed_responses':
                            // ì¼ë¶€ëŠ” ì°¬ì„±, ì¼ë¶€ëŠ” ë°˜ëŒ€, ì¼ë¶€ëŠ” ëŠ¦ì€ ì‘ë‹µ (15ì´ˆ ì´ˆê³¼)
                            const behavior = Math.random();
                            if (behavior < 0.4) {
                                person.voteDecision = 'agree';
                                person.willRespond = true;
                            } else if (behavior < 0.7) {
                                person.voteDecision = 'disagree';
                                person.willRespond = true;
                            } else {
                                // ëŠ¦ì€ ì‘ë‹µ (15ì´ˆ í›„ì— ì‘ë‹µí•˜ë ¤ê³  ì‹œë„)
                                person.voteDecision = 'agree';
                                person.willRespond = true;
                                person.responseTime = 16000 + Math.random() * 5000; // 16-21ì´ˆ
                            }
                            break;
                            
                        case 'split_vote':
                            // ëª…í™•í•œ ì°¬ì„±/ë°˜ëŒ€ ë¶„í• 
                            person.voteDecision = Math.random() < 0.6 ? 'agree' : 'disagree';
                            person.willRespond = true;
                            break;
                    }
                }

                people.push(person);

                const personDiv = document.createElement('div');
                personDiv.className = 'person';
                personDiv.id = `person-${i}`;
                
                let statusText = 'ëŒ€ê¸° ì¤‘';
                if (person.failed) {
                    statusText = 'ì¥ì•  ì˜ˆì • ğŸ”§';
                } else if (person.responseTime > 15000) {
                    statusText = 'ëŠ¦ì€ ì‘ë‹µ ì˜ˆì • â°';
                }
                
                personDiv.innerHTML = `
                    <div class="person-avatar">${i + 1}</div>
                    <div class="person-name">${person.name}</div>
                    <div class="person-status">${statusText}</div>
                `;
                
                // ì¥ì•  ë…¸ë“œ ë¯¸ë¦¬ í‘œì‹œ
                if (person.failed) {
                    personDiv.style.opacity = '0.6';
                    personDiv.style.border = '2px dashed #ff6b6b';
                } else if (person.responseTime > 15000) {
                    personDiv.style.opacity = '0.8';
                    personDiv.style.border = '2px dashed #ffa726';
                }
                
                grid.appendChild(personDiv);
            }

            // ì‹œë‚˜ë¦¬ì˜¤ ì •ë³´ í‘œì‹œ
            updateScenarioInfo(scenario);
        }

        function updateScenarioInfo(scenario) {
            const scenarioNames = {
                'unanimous': 'ğŸ¯ ì‹œë‚˜ë¦¬ì˜¤: ì „ì²´ ì°¬ì„± (9ëª… ì°¬ì„± + 1ëª… ì¥ì• )',
                'mixed_responses': 'ğŸ² ì‹œë‚˜ë¦¬ì˜¤: í˜¼í•© ì‘ë‹µ (ì°¬ì„±/ë°˜ëŒ€/ëŠ¦ì€ì‘ë‹µ/ì¥ì• )',
                'split_vote': 'âš–ï¸ ì‹œë‚˜ë¦¬ì˜¤: ë¶„í•  íˆ¬í‘œ (ì°¬ì„± vs ë°˜ëŒ€ + 1ëª… ì¥ì• )'
            };
            
            let scenarioDiv = document.getElementById('scenarioInfo');
            if (!scenarioDiv) {
                scenarioDiv = document.createElement('div');
                scenarioDiv.id = 'scenarioInfo';
                scenarioDiv.style.cssText = `
                    text-align: center;
                    font-size: 16px;
                    font-weight: bold;
                    color: #FFD700;
                    background: rgba(255, 215, 0, 0.1);
                    padding: 10px;
                    border-radius: 8px;
                    margin: 15px 0;
                `;
                document.querySelector('.simulation-area').insertBefore(scenarioDiv, document.getElementById('peopleGrid'));
            }
            
            scenarioDiv.textContent = scenarioNames[scenario];
        }

        function startSimulation() {
            if (simulationRunning) return;
            
            simulationRunning = true;
            startTime = Date.now();
            phase = 'proposing';
            
            document.getElementById('startBtn').disabled = true;
            document.getElementById('proposalSection').style.display = 'block';
            
            startTimer();
            makeProposal();
        }

        function makeProposal() {
            // ì œì•ˆì ì„ íƒ (ì¥ì• ê°€ ì—†ëŠ” ì‚¬ëŒ ì¤‘ì—ì„œ)
            const healthyPeople = people.filter(p => !p.failed);
            const proposer = healthyPeople[proposerIndex % healthyPeople.length];
            
            // ì œì•ˆí•  ë©”ë‰´ ì„ íƒ (ì œì•ˆìì˜ ì„ í˜¸ë„ ê¸°ë°˜)
            currentProposal = menuItems.find(item => item.id === proposer.preference) || menuItems[0];
            
            // ì œì•ˆì í‘œì‹œ
            document.getElementById(`person-${proposer.id}`).classList.add('proposer');
            
            // ì œì•ˆ ì •ë³´ ì—…ë°ì´íŠ¸
            document.getElementById('proposerInfo').textContent = 
                `${proposer.name}ë‹˜ì´ ë©”ë‰´ë¥¼ ì œì•ˆí•©ë‹ˆë‹¤ (ë¼ìš´ë“œ ${round})`;
            document.getElementById('currentProposal').textContent = 
                `${currentProposal.emoji} ${currentProposal.name}`;
            document.getElementById('currentProposalStatus').textContent = 
                `${currentProposal.name}`;
            
            // ë©”ë‰´ ì˜µì…˜ í•˜ì´ë¼ì´íŠ¸
            document.querySelectorAll('.menu-option').forEach(option => {
                option.classList.remove('current-proposal');
            });
            document.getElementById(`menu-${currentProposal.id}`).classList.add('current-proposal');
            
            updatePhaseIndicator();
            
            // ë©”ì‹œì§€ ì „ì†¡ ì‹œë®¬ë ˆì´ì…˜
            setTimeout(() => {
                phase = 'voting';
                updatePhaseIndicator();
                startVoting();
            }, 2000);
        }

        function startVoting() {
            // ê° ì‚¬ëŒì˜ íˆ¬í‘œ ì‹œì‘ (ì¥ì•  ë…¸ë“œ ì œì™¸)
            people.forEach((person, index) => {
                if (!person.failed && index !== people.findIndex((p, i) => document.getElementById(`person-${i}`).classList.contains('proposer'))) {
                    setTimeout(() => {
                        if (simulationRunning && phase === 'voting') {
                            castVote(person);
                        }
                    }, person.responseTime);
                } else if (person.failed) {
                    // ì¥ì•  ë…¸ë“œëŠ” ì¦‰ì‹œ í‘œì‹œ
                    setTimeout(() => {
                        showFailedNode(person);
                    }, 1000);
                }
            });

            // ì œì•ˆìëŠ” ìë™ìœ¼ë¡œ ì°¬ì„±
            const proposerIndex = people.findIndex((p, i) => document.getElementById(`person-${i}`).classList.contains('proposer'));
            if (proposerIndex !== -1) {
                const proposer = people[proposerIndex];
                setTimeout(() => {
                    proposer.vote = 'agree';
                    proposer.status = 'voted';
                    updatePersonDisplay(proposer);
                    updateStatus();
                }, 500);
            }

            // ë©”ì‹œì§€ êµí™˜ ì• ë‹ˆë©”ì´ì…˜
            startMessageAnimation();
            
            // 15ì´ˆ í›„ ê°•ì œ ì¢…ë£Œ (ì‹œê°„ ì œí•œ)
            setTimeout(() => {
                if (simulationRunning) {
                    timeoutSimulation();
                }
            }, 15000);
        }

        function castVote(person) {
            // ë¯¸ë¦¬ ì •í•´ì§„ íˆ¬í‘œ ê²°ì •ì— ë”°ë¼ íˆ¬í‘œ
            person.vote = person.voteDecision;
            person.status = 'voted';
            
            updatePersonDisplay(person);
            
            // ë©”ì‹œì§€ ë²„ë¸” í‘œì‹œ
            const message = person.vote === 'agree' ? 'ì°¬ì„±!' : 'ë°˜ëŒ€!';
            showMessageBubble(person, message);
            
            updateStatus();
            checkConsensus();
        }

        function updatePersonDisplay(person) {
            const personDiv = document.getElementById(`person-${person.id}`);
            personDiv.classList.add('thinking');
            
            // íˆ¬í‘œ í‘œì‹œ
            let voteDiv = personDiv.querySelector('.person-vote');
            if (!voteDiv) {
                voteDiv = document.createElement('div');
                voteDiv.className = 'person-vote';
                personDiv.appendChild(voteDiv);
            }
            
            if (person.vote === 'agree') {
                voteDiv.className = 'person-vote vote-agree';
                voteDiv.textContent = 'âœ“ ì°¬ì„±';
            } else {
                voteDiv.className = 'person-vote vote-disagree';
                voteDiv.textContent = 'âœ— ë°˜ëŒ€';
            }
            
            // ìƒíƒœ ì—…ë°ì´íŠ¸
            const statusDiv = personDiv.querySelector('.person-status');
            statusDiv.textContent = person.vote === 'agree' ? 'ì°¬ì„± íˆ¬í‘œ' : 'ë°˜ëŒ€ íˆ¬í‘œ';
        }

        function showFailedNode(person) {
            const personDiv = document.getElementById(`person-${person.id}`);
            personDiv.classList.add('failed');
            
            const statusDiv = personDiv.querySelector('.person-status');
            statusDiv.textContent = 'ì‘ë‹µ ì—†ìŒ ğŸ˜µ';
            
            person.status = 'failed';
            updateStatus();
        }

        function showMessageBubble(person, message) {
            const personDiv = document.getElementById(`person-${person.id}`);
            const rect = personDiv.getBoundingClientRect();
            const container = document.getElementById('messageLines');
            const containerRect = container.getBoundingClientRect();
            
            const bubble = document.createElement('div');
            bubble.className = 'message-bubble';
            bubble.textContent = message;
            bubble.style.left = (rect.left - containerRect.left + rect.width/2) + 'px';
            bubble.style.top = (rect.top - containerRect.top - 30) + 'px';
            
            container.appendChild(bubble);
            
            setTimeout(() => {
                if (container.contains(bubble)) {
                    container.removeChild(bubble);
                }
            }, 3000);
        }

        function updateStatus() {
            const agreeCount = people.filter(p => p.vote === 'agree').length;
            const disagreeCount = people.filter(p => p.vote === 'disagree').length;
            const waitingCount = people.filter(p => p.status === 'waiting').length;
            const failedCount = people.filter(p => p.failed || p.status === 'failed').length;
            
            document.getElementById('agreeCount').textContent = `${agreeCount}ëª…`;
            document.getElementById('disagreeCount').textContent = `${disagreeCount}ëª…`;
            document.getElementById('waitingCount').textContent = `${waitingCount}ëª…`;
            document.getElementById('failedCount').textContent = `${failedCount}ëª…`;
            
            const totalResponses = agreeCount + disagreeCount;
            const totalExpected = people.filter(p => !p.failed).length;
            
            if (totalResponses > 0) {
                const agreePercent = (agreeCount / totalExpected) * 100;
                const disagreePercent = (disagreeCount / totalExpected) * 100;
                
                document.getElementById('agreeBar').style.width = `${agreePercent}%`;
                document.getElementById('disagreeBar').style.width = `${disagreePercent}%`;
                document.getElementById('agreeBar').textContent = `ì°¬ì„± ${agreeCount}`;
                document.getElementById('disagreeBar').textContent = `ë°˜ëŒ€ ${disagreeCount}`;
            }
        }

        function checkConsensus() {
            const healthyPeople = people.filter(p => !p.failed && p.status !== 'failed');
            const votedPeople = people.filter(p => p.vote !== null);
            const agreeCount = people.filter(p => p.vote === 'agree').length;
            const disagreeCount = people.filter(p => p.vote === 'disagree').length;
            
            // ëª¨ë“  ê±´ê°•í•œ ì‚¬ëŒì´ ì‘ë‹µí–ˆëŠ”ì§€ í™•ì¸
            if (votedPeople.length >= healthyPeople.length) {
                if (disagreeCount === 0) {
                    // ì „ì› ì°¬ì„± (9ëª… ëª¨ë‘)
                    successfulConsensus();
                } else {
                    // ë°˜ëŒ€ ì˜ê²¬ ì¡´ì¬
                    failedConsensus();
                }
            } else if (votedPeople.length > 0 && votedPeople.length < healthyPeople.length) {
                // ì¼ë¶€ë§Œ ì‘ë‹µí•œ ìƒíƒœ (15ì´ˆ ë‚´ ëŒ€ê¸°)
                phase = 'waiting';
                updatePhaseIndicator();
            }
        }

        function successfulConsensus() {
            phase = 'consensus_success';
            simulationRunning = false;
            
            const healthyCount = people.filter(p => !p.failed).length;
            const failedPerson = people.find(p => p.failed);
            const currentScenario = people[0].scenario;
            
            const result = document.getElementById('finalResult');
            result.className = 'final-result result-success';
            result.style.display = 'block';
            result.innerHTML = `
                <h3>ğŸ‰ ë¼ìš´ë“œ ${round} í•©ì˜ ì„±ê³µ!</h3>
                <p><strong>ì„ íƒëœ ë©”ë‰´:</strong> ${currentProposal.emoji} ${currentProposal.name}</p>
                <p><strong>ê²°ê³¼:</strong> ${healthyCount}ëª… ì „ì²´ ì°¬ì„± (${failedPerson.name}ë‹˜ ì¥ì• ë¡œ ì œì™¸)</p>
                <p><strong>ê²½ê³¼ ì‹œê°„:</strong> 15ì´ˆ ì œí•œì‹œê°„ ë‚´ ì™„ë£Œ</p>
                <hr style="margin: 15px 0; opacity: 0.3;">
                <p><strong>ğŸ€ ìš´ì´ ì¢‹ì•˜ë„¤ìš”!</strong></p>
                ${currentScenario === 'unanimous' ? 
                    '<p>â€¢ ëª¨ë“  ì •ìƒ ë…¸ë“œê°€ ì°¬ì„±í•˜ëŠ” ì´ìƒì ì¸ ì‹œë‚˜ë¦¬ì˜¤ì˜€ìŠµë‹ˆë‹¤</p>' :
                    '<p>â€¢ ì˜ˆìƒë³´ë‹¤ ë¹¨ë¦¬ ëª¨ë“  ì‚¬ëŒì´ ë™ì˜í–ˆìŠµë‹ˆë‹¤</p>'
                }
                <p><strong>ğŸ¯ í•˜ì§€ë§Œ FLP ì •ë¦¬ìƒ:</strong> ë‹¤ìŒ ë¼ìš´ë“œì—ì„œëŠ” ì‹¤íŒ¨í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤!</p>
            `;
            
            updatePhaseIndicator();
            document.getElementById('startBtn').disabled = false;
            document.getElementById('nextRoundBtn').style.display = 'inline-block';
        }

        function failedConsensus() {
            phase = 'consensus_failed';
            
            const result = document.getElementById('finalResult');
            result.className = 'final-result result-failed';
            result.style.display = 'block';
            result.innerHTML = `
                <h3>ğŸ”„ í•©ì˜ ì‹¤íŒ¨ - ë‹¤ìŒ ë¼ìš´ë“œ í•„ìš”</h3>
                <p>ì œì•ˆëœ ë©”ë‰´: ${currentProposal.emoji} ${currentProposal.name}</p>
                <p>ë°˜ëŒ€ ì˜ê²¬ì´ ìˆì–´ í•©ì˜ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.</p>
                <p>ë‹¤ë¥¸ ì‚¬ëŒì´ ìƒˆë¡œìš´ ë©”ë‰´ë¥¼ ì œì•ˆí•´ì•¼ í•©ë‹ˆë‹¤.</p>
            `;
            
            updatePhaseIndicator();
            document.getElementById('nextRoundBtn').style.display = 'inline-block';
        }

        function timeoutSimulation() {
            phase = 'timeout';
            simulationRunning = false;
            
            const healthyCount = people.filter(p => !p.failed).length;
            const votedCount = people.filter(p => p.vote !== null).length;
            const agreeCount = people.filter(p => p.vote === 'agree').length;
            const disagreeCount = people.filter(p => p.vote === 'disagree').length;
            const noResponseCount = healthyCount - votedCount;
            const failedPerson = people.find(p => p.failed);
            
            const result = document.getElementById('finalResult');
            result.className = 'final-result result-timeout';
            result.style.display = 'block';
            
            let timeoutReason = '';
            if (noResponseCount > 0) {
                timeoutReason = `${noResponseCount}ëª…ì´ 15ì´ˆ ë‚´ì— ì‘ë‹µí•˜ì§€ ëª»í•¨`;
            } else if (disagreeCount > 0) {
                timeoutReason = `${disagreeCount}ëª…ì˜ ë°˜ëŒ€ ì˜ê²¬ìœ¼ë¡œ í•©ì˜ ë¶ˆê°€ëŠ¥`;
            } else {
                timeoutReason = 'ì‹œê°„ ë‚´ ì™„ì „í•œ í•©ì˜ ë‹¬ì„± ì‹¤íŒ¨';
            }
            
            result.innerHTML = `
                <h3>â° 15ì´ˆ ì‹œê°„ ì´ˆê³¼ - í•©ì˜ ì‹¤íŒ¨!</h3>
                <p><strong>ë¼ìš´ë“œ ${round} ê²°ê³¼:</strong></p>
                <p>â€¢ ì°¬ì„±: ${agreeCount}ëª… | ë°˜ëŒ€: ${disagreeCount}ëª… | ë¬´ì‘ë‹µ: ${noResponseCount}ëª… | ì¥ì• : 1ëª… (${failedPerson.name})</p>
                <p><strong>ì‹¤íŒ¨ ì›ì¸:</strong> ${timeoutReason}</p>
                <hr style="margin: 15px 0; opacity: 0.3;">
                <p><strong>ğŸ¤” í˜„ì‹¤ì  ë”œë ˆë§ˆ:</strong></p>
                ${noResponseCount > 0 ? 
                    `<p>"${agreeCount}ëª…ì´ ì°¬ì„±í–ˆëŠ”ë° ${noResponseCount}ëª…ì´ ë‹µì´ ì—†ì–´ìš”. ê·¸ëƒ¥ ê²°ì •í• ê¹Œìš”?"</p>` :
                    `<p>"ì°¬ì„± ${agreeCount}ëª…, ë°˜ëŒ€ ${disagreeCount}ëª…... ì–´ë–»ê²Œ ê²°ì •í•˜ì£ ?"</p>`
                }
                <p><strong>ğŸ¯ FLP ì •ë¦¬:</strong> ì™„ì „ ë¹„ë™ê¸° í™˜ê²½ì—ì„œëŠ” "15ì´ˆ ë‚´ ë°˜ë“œì‹œ í•©ì˜"ë¥¼ ë³´ì¥í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤!</p>
            `;
            
            updatePhaseIndicator();
            document.getElementById('startBtn').disabled = false;
            document.getElementById('nextRoundBtn').style.display = 'inline-block';
        }

        function nextRound() {
            round++;
            proposerIndex++;
            phase = 'ready';
            
            // ì´ì „ ë¼ìš´ë“œ ì •ë¦¬
            document.querySelectorAll('.person').forEach(person => {
                person.classList.remove('proposer', 'thinking', 'failed');
                person.style.opacity = '1';
                person.style.border = 'none';
                const voteDiv = person.querySelector('.person-vote');
                if (voteDiv) voteDiv.remove();
            });
            
            document.getElementById('finalResult').style.display = 'none';
            document.getElementById('nextRoundBtn').style.display = 'none';
            document.getElementById('startBtn').disabled = false;
            
            // ì‹œë‚˜ë¦¬ì˜¤ ì •ë³´ ì œê±°
            const scenarioDiv = document.getElementById('scenarioInfo');
            if (scenarioDiv) scenarioDiv.remove();
            
            updateStatus();
            updatePhaseIndicator();
            
            // ìƒˆë¡œìš´ ë¼ìš´ë“œë¥¼ ìœ„í•´ ì‚¬ëŒë“¤ ì¬ì´ˆê¸°í™”
            initializePeople();
        }

        function startMessageAnimation() {
            const messageInterval = setInterval(() => {
                if (!simulationRunning || (phase !== 'voting' && phase !== 'waiting')) {
                    clearInterval(messageInterval);
                    return;
                }
                
                const messageLines = document.getElementById('messageLines');
                const line = document.createElement('div');
                line.className = 'message-line';
                line.style.top = Math.random() * 400 + 'px';
                line.style.left = Math.random() * 600 + 'px';
                messageLines.appendChild(line);
                
                setTimeout(() => {
                    if (messageLines.contains(line)) {
                        messageLines.removeChild(line);
                    }
                }, 2000);
            }, 800);
        }

        function startTimer() {
            timerInterval = setInterval(() => {
                if (!simulationRunning) {
                    clearInterval(timerInterval);
                    return;
                }
                
                const elapsed = Date.now() - startTime;
                const seconds = Math.floor(elapsed / 1000);
                const remaining = Math.max(0, 15 - seconds);
                
                document.getElementById('timer').textContent = 
                    `â° ì œí•œì‹œê°„: 15ì´ˆ | ê²½ê³¼: ${seconds}ì´ˆ | ë‚¨ì€ ì‹œê°„: ${remaining}ì´ˆ`;
                
                // ì‹œê°„ì´ ì–¼ë§ˆ ë‚¨ì§€ ì•Šìœ¼ë©´ ê²½ê³  ìƒ‰ìƒ
                if (remaining <= 5 && remaining > 0) {
                    document.getElementById('timer').style.color = '#ff6b6b';
                } else if (remaining === 0) {
                    document.getElementById('timer').style.color = '#ff4444';
                    document.getElementById('timer').textContent = 'â° ì‹œê°„ ì´ˆê³¼! 15ì´ˆ ê²½ê³¼';
                }
            }, 100);
        }

        function updatePhaseIndicator() {
            document.getElementById('phaseIndicator').textContent = phases[phase];
        }

        function resetSimulation() {
            simulationRunning = false;
            phase = 'ready';
            currentProposal = null;
            proposerIndex = 0;
            round = 1;
            
            if (timerInterval) {
                clearInterval(timerInterval);
            }
            
            document.getElementById('timer').textContent = 'â° ì œí•œì‹œê°„: 15ì´ˆ | ê²½ê³¼ ì‹œê°„: 00:00';
            document.getElementById('timer').style.color = '#FFD700';
            document.getElementById('finalResult').style.display = 'none';
            document.getElementById('proposalSection').style.display = 'none';
            document.getElementById('nextRoundBtn').style.display = 'none';
            document.getElementById('startBtn').disabled = false;
            document.getElementById('currentProposalStatus').textContent = 'ì—†ìŒ';
            
            // í•©ì˜ ë°” ë¦¬ì…‹
            document.getElementById('agreeBar').style.width = '0%';
            document.getElementById('disagreeBar').style.width = '0%';
            document.getElementById('agreeBar').textContent = 'ì°¬ì„± 0';
            document.getElementById('disagreeBar').textContent = 'ë°˜ëŒ€ 0';
            
            // ë©”ë‰´ í•˜ì´ë¼ì´íŠ¸ ì œê±°
            document.querySelectorAll('.menu-option').forEach(option => {
                option.classList.remove('current-proposal');
            });
            
            const messageLines = document.getElementById('messageLines');
            messageLines.innerHTML = '';
            
            updatePhaseIndicator();
            initializePeople();
            updateStatus();
        }

        // ì´ˆê¸°í™”
        window.onload = function() {
            initializePeople();
            updateStatus();
        };
    </script>
</body>
</html>
