<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í•œêµ­ì§€ë„ ìƒ¤ë”© ì‹œê°í™”</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            color: white;
            overflow-x: auto;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            position: relative;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            gap: 40px;
        }

        .map-section {
            flex: 0 0 auto;
        }

        .title {
            text-align: center;
            font-size: 2.5em;
            margin-bottom: 30px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            color: #fff;
        }

        .korea-map-container {
            position: relative;
            width: 900px;
            height: 800px;
            margin: 0 auto;
            background: rgba(255,255,255,0.1);
            border-radius: 20px;
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255,255,255,0.3);
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .korea-map-svg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }

        .region {
            cursor: pointer;
            transition: all 0.3s ease;
            stroke: #ffffff;
            stroke-width: 3;
            stroke-linejoin: round;
            stroke-linecap: round;
            position: relative;
        }

        .region:hover {
            stroke-width: 4;
            filter: brightness(1.2);
        }

        .region.processing {
            animation: pulse-region 1.5s infinite;
        }

        .region.active {
            animation: glow 1s ease-out;
        }

        @keyframes pulse-region {
            0%, 100% { filter: brightness(1); }
            50% { filter: brightness(1.4); }
        }

        @keyframes glow {
            0% { filter: brightness(1); }
            50% { filter: brightness(1.6) drop-shadow(0 0 10px currentColor); }
            100% { filter: brightness(1); }
        }

        /* ì§€ì—­ ë‚´ ë…¸ë“œ í‘œì‹œ */
        .node {
            position: absolute;
            width: 8px;
            height: 8px;
            background: #ffffff;
            border-radius: 50%;
            border: 2px solid #333;
            transition: all 0.3s ease;
            z-index: 15;
        }

        .node.active {
            background: #00ff88;
            box-shadow: 0 0 12px #00ff88;
            transform: scale(1.5);
            animation: node-pulse 0.8s ease-out;
        }

        .node.processing {
            background: #ffd700;
            box-shadow: 0 0 12px #ffd700;
            animation: node-blink 1s infinite;
        }

        @keyframes node-pulse {
            0% { transform: scale(1); }
            50% { transform: scale(2); }
            100% { transform: scale(1.2); }
        }

        @keyframes node-blink {
            0%, 50% { opacity: 1; transform: scale(1.3); }
            51%, 100% { opacity: 0.6; transform: scale(1); }
        }

        /* ì§€ì—­ ë‚´ í™œë™ í‘œì‹œê¸° */
        .region-activity {
            position: absolute;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle, rgba(0,255,136,0.1) 0%, transparent 70%);
            opacity: 0;
            border-radius: 10px;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }

        .region-activity.active {
            opacity: 1;
            animation: activity-pulse 2s ease-in-out infinite;
        }

        @keyframes activity-pulse {
            0%, 100% { 
                background: radial-gradient(circle, rgba(0,255,136,0.1) 0%, transparent 70%);
                transform: scale(1);
            }
            50% { 
                background: radial-gradient(circle, rgba(0,255,136,0.2) 0%, transparent 80%);
                transform: scale(1.02);
            }
        }

        /* ì§€ì—­ë³„ ìƒ‰ìƒ */
        .seoul { fill: rgba(255, 99, 132, 0.8); }
        .gyeonggi { fill: rgba(255, 99, 255, 0.8); }
        .gangwon { fill: rgba(99, 255, 132, 0.8); }
        .chungcheong { fill: rgba(255, 205, 86, 0.8); }
        .gyeongsang { fill: rgba(54, 162, 235, 0.8); }
        .jeolla { fill: rgba(153, 102, 255, 0.8); }

        .region-label {
            position: absolute;
            font-weight: bold;
            font-size: 14px;
            text-align: center;
            color: white;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
            pointer-events: none;
            z-index: 10;
        }

        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-left: 8px;
            border: 2px solid white;
        }

        .status-active { background: #00ff88; animation: blink 1s infinite; }
        .status-processing { background: #ffd700; animation: pulse-yellow 1.5s infinite; }
        .status-idle { background: #666; }

        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0.3; }
        }

        @keyframes pulse-yellow {
            0%, 100% { opacity: 0.6; }
            50% { opacity: 1; }
        }

        .beacon-chain {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(45deg, #ffd700, #ffed4e);
            color: #000;
            padding: 15px 30px;
            border-radius: 15px;
            font-weight: bold;
            font-size: 14px;
            box-shadow: 0 4px 20px rgba(255, 215, 0, 0.4);
            border: 2px solid #fff;
            z-index: 20;
        }

        .transaction-line {
            position: absolute;
            background: linear-gradient(90deg, transparent, #00ff88, #00ff88, transparent);
            border-radius: 2px;
            opacity: 0;
            animation: transaction-flow 2.5s ease-in-out;
            pointer-events: none;
            box-shadow: 0 0 6px rgba(0, 255, 136, 0.5);
        }

        @keyframes transaction-flow {
            0% { opacity: 0; transform: scaleX(0); }
            20% { opacity: 1; transform: scaleX(0.2); }
            80% { opacity: 1; transform: scaleX(1); }
            100% { opacity: 0; transform: scaleX(1); }
        }

        .info-panel {
            position: static;
            background: rgba(0,0,0,0.4);
            padding: 20px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
            width: 280px;
            z-index: 20;
            margin-top: 20px;
        }

        .info-item {
            margin: 10px 0;
            font-size: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="map-section">
            <h1 class="title">ğŸ—ºï¸ í•œêµ­ 6ê°œ ê¶Œì—­ ìƒ¤ë”© ì‹œê°í™”</h1>
            
            <div class="korea-map-container">
                <!-- ë¹„ì½˜ ì²´ì¸ -->
                <div class="beacon-chain">
                    ğŸ”— ë¹„ì½˜ ì²´ì¸ (ë©”íƒ€ë°ì´í„° ê´€ë¦¬)
                </div>
                
                <!-- SVG ê¸°ë°˜ í•œêµ­ ì§€ë„ - ë™ì¼í•œ í¬ê¸°ë¡œ ë°°ì¹˜ -->
                <svg class="korea-map-svg" viewBox="0 0 900 800" xmlns="http://www.w3.org/2000/svg">
                    <!-- ê²½ê¸°ë„ (ìƒë‹¨ ì¢Œì¸¡) -->
                    <rect class="region gyeonggi" data-region="gyeonggi" 
                          x="150" y="150" width="200" height="150" rx="10" />
                    <!-- ê²½ê¸°ë„ ë‚´ë¶€ ë°•ìŠ¤ë“¤ -->
                    <rect x="160" y="170" width="35" height="25" rx="3" fill="rgba(255,255,255,0.4)" stroke="#fff" stroke-width="1"/>
                    <rect x="210" y="160" width="35" height="25" rx="3" fill="rgba(255,255,255,0.4)" stroke="#fff" stroke-width="1"/>
                    <rect x="270" y="180" width="35" height="25" rx="3" fill="rgba(255,255,255,0.4)" stroke="#fff" stroke-width="1"/>
                    <rect x="230" y="210" width="35" height="25" rx="3" fill="rgba(255,255,255,0.4)" stroke="#fff" stroke-width="1"/>
                    <rect x="300" y="230" width="35" height="25" rx="3" fill="rgba(255,255,255,0.4)" stroke="#fff" stroke-width="1"/>
                    
                    <!-- ê°•ì›ë„ (ìƒë‹¨ ìš°ì¸¡) -->
                    <rect class="region gangwon" data-region="gangwon" 
                          x="400" y="150" width="200" height="150" rx="10" />
                    <!-- ê°•ì›ë„ ë‚´ë¶€ ë°•ìŠ¤ë“¤ -->
                    <rect x="410" y="170" width="35" height="25" rx="3" fill="rgba(255,255,255,0.4)" stroke="#fff" stroke-width="1"/>
                    <rect x="470" y="180" width="35" height="25" rx="3" fill="rgba(255,255,255,0.4)" stroke="#fff" stroke-width="1"/>
                    <rect x="530" y="190" width="35" height="25" rx="3" fill="rgba(255,255,255,0.4)" stroke="#fff" stroke-width="1"/>
                    <rect x="550" y="220" width="35" height="25" rx="3" fill="rgba(255,255,255,0.4)" stroke="#fff" stroke-width="1"/>
                    <rect x="490" y="240" width="35" height="25" rx="3" fill="rgba(255,255,255,0.4)" stroke="#fff" stroke-width="1"/>
                    
                    <!-- ì¶©ì²­ë„ (ì¤‘ë‹¨ ì¢Œì¸¡) -->
                    <rect class="region chungcheong" data-region="chungcheong" 
                          x="150" y="350" width="200" height="150" rx="10" />
                    <!-- ì¶©ì²­ë„ ë‚´ë¶€ ë°•ìŠ¤ë“¤ -->
                    <rect x="160" y="370" width="35" height="25" rx="3" fill="rgba(255,255,255,0.4)" stroke="#fff" stroke-width="1"/>
                    <rect x="210" y="380" width="35" height="25" rx="3" fill="rgba(255,255,255,0.4)" stroke="#fff" stroke-width="1"/>
                    <rect x="170" y="410" width="35" height="25" rx="3" fill="rgba(255,255,255,0.4)" stroke="#fff" stroke-width="1"/>
                    <rect x="270" y="430" width="35" height="25" rx="3" fill="rgba(255,255,255,0.4)" stroke="#fff" stroke-width="1"/>
                    
                    <!-- ì„œìš¸íŠ¹ë³„ì‹œ (ì¤‘ë‹¨ ìš°ì¸¡) -->
                    <rect class="region seoul" data-region="seoul" 
                          x="400" y="350" width="200" height="150" rx="10" />
                    <!-- ì„œìš¸ ë‚´ë¶€ ë°•ìŠ¤ë“¤ -->
                    <rect x="410" y="370" width="35" height="25" rx="3" fill="rgba(255,255,255,0.4)" stroke="#fff" stroke-width="1"/>
                    <rect x="470" y="380" width="35" height="25" rx="3" fill="rgba(255,255,255,0.4)" stroke="#fff" stroke-width="1"/>
                    <rect x="520" y="400" width="35" height="25" rx="3" fill="rgba(255,255,255,0.4)" stroke="#fff" stroke-width="1"/>
                    <rect x="440" y="430" width="35" height="25" rx="3" fill="rgba(255,255,255,0.4)" stroke="#fff" stroke-width="1"/>
                    
                    <!-- ì „ë¼ë„ (í•˜ë‹¨ ì¢Œì¸¡) -->
                    <rect class="region jeolla" data-region="jeolla" 
                          x="150" y="550" width="200" height="150" rx="10" />
                    <!-- ì „ë¼ë„ ë‚´ë¶€ ë°•ìŠ¤ë“¤ -->
                    <rect x="160" y="570" width="35" height="25" rx="3" fill="rgba(255,255,255,0.4)" stroke="#fff" stroke-width="1"/>
                    <rect x="210" y="580" width="35" height="25" rx="3" fill="rgba(255,255,255,0.4)" stroke="#fff" stroke-width="1"/>
                    <rect x="170" y="610" width="35" height="25" rx="3" fill="rgba(255,255,255,0.4)" stroke="#fff" stroke-width="1"/>
                    <rect x="270" y="630" width="35" height="25" rx="3" fill="rgba(255,255,255,0.4)" stroke="#fff" stroke-width="1"/>
                    
                    <!-- ê²½ìƒë„ (í•˜ë‹¨ ìš°ì¸¡) -->
                    <rect class="region gyeongsang" data-region="gyeongsang" 
                          x="400" y="550" width="200" height="150" rx="10" />
                    <!-- ê²½ìƒë„ ë‚´ë¶€ ë°•ìŠ¤ë“¤ -->
                    <rect x="410" y="570" width="35" height="25" rx="3" fill="rgba(255,255,255,0.4)" stroke="#fff" stroke-width="1"/>
                    <rect x="470" y="580" width="35" height="25" rx="3" fill="rgba(255,255,255,0.4)" stroke="#fff" stroke-width="1"/>
                    <rect x="530" y="590" width="35" height="25" rx="3" fill="rgba(255,255,255,0.4)" stroke="#fff" stroke-width="1"/>
                    <rect x="450" y="610" width="35" height="25" rx="3" fill="rgba(255,255,255,0.4)" stroke="#fff" stroke-width="1"/>
                    <rect x="550" y="630" width="35" height="25" rx="3" fill="rgba(255,255,255,0.4)" stroke="#fff" stroke-width="1"/>
                </svg>
                
                <!-- ì§€ì—­ í™œë™ í‘œì‹œê¸°ë“¤ (SVG ì™¸ë¶€ë¡œ ì´ë™) -->
                <div class="region-activity" style="position: absolute; left: 150px; top: 150px; width: 200px; height: 150px;"></div>
                <div class="region-activity" style="position: absolute; left: 400px; top: 150px; width: 200px; height: 150px;"></div>
                <div class="region-activity" style="position: absolute; left: 150px; top: 350px; width: 200px; height: 150px;"></div>
                <div class="region-activity" style="position: absolute; left: 400px; top: 350px; width: 200px; height: 150px;"></div>
                <div class="region-activity" style="position: absolute; left: 150px; top: 550px; width: 200px; height: 150px;"></div>
                <div class="region-activity" style="position: absolute; left: 400px; top: 550px; width: 200px; height: 150px;"></div>
                
                <!-- ì§€ì—­ë³„ ë…¸ë“œë“¤ -->
                <!-- ê²½ê¸°ë„ ë…¸ë“œë“¤ -->
                <div class="node" style="left: 170px; top: 180px;" data-region="gyeonggi" data-node="0"></div>
                <div class="node" style="left: 220px; top: 170px;" data-region="gyeonggi" data-node="1"></div>
                <div class="node" style="left: 280px; top: 190px;" data-region="gyeonggi" data-node="2"></div>
                <div class="node" style="left: 240px; top: 220px;" data-region="gyeonggi" data-node="3"></div>
                <div class="node" style="left: 310px; top: 240px;" data-region="gyeonggi" data-node="4"></div>
                
                <!-- ê°•ì›ë„ ë…¸ë“œë“¤ -->
                <div class="node" style="left: 420px; top: 180px;" data-region="gangwon" data-node="0"></div>
                <div class="node" style="left: 480px; top: 190px;" data-region="gangwon" data-node="1"></div>
                <div class="node" style="left: 540px; top: 200px;" data-region="gangwon" data-node="2"></div>
                <div class="node" style="left: 560px; top: 230px;" data-region="gangwon" data-node="3"></div>
                <div class="node" style="left: 500px; top: 250px;" data-region="gangwon" data-node="4"></div>
                
                <!-- ì¶©ì²­ë„ ë…¸ë“œë“¤ -->
                <div class="node" style="left: 170px; top: 380px;" data-region="chungcheong" data-node="0"></div>
                <div class="node" style="left: 220px; top: 390px;" data-region="chungcheong" data-node="1"></div>
                <div class="node" style="left: 180px; top: 420px;" data-region="chungcheong" data-node="2"></div>
                <div class="node" style="left: 280px; top: 440px;" data-region="chungcheong" data-node="3"></div>
                
                <!-- ì„œìš¸ ë…¸ë“œë“¤ -->
                <div class="node" style="left: 420px; top: 380px;" data-region="seoul" data-node="0"></div>
                <div class="node" style="left: 480px; top: 390px;" data-region="seoul" data-node="1"></div>
                <div class="node" style="left: 530px; top: 410px;" data-region="seoul" data-node="2"></div>
                <div class="node" style="left: 450px; top: 440px;" data-region="seoul" data-node="3"></div>
                
                <!-- ì „ë¼ë„ ë…¸ë“œë“¤ -->
                <div class="node" style="left: 170px; top: 580px;" data-region="jeolla" data-node="0"></div>
                <div class="node" style="left: 220px; top: 590px;" data-region="jeolla" data-node="1"></div>
                <div class="node" style="left: 180px; top: 620px;" data-region="jeolla" data-node="2"></div>
                <div class="node" style="left: 280px; top: 640px;" data-region="jeolla" data-node="3"></div>
                
                <!-- ê²½ìƒë„ ë…¸ë“œë“¤ -->
                <div class="node" style="left: 420px; top: 580px;" data-region="gyeongsang" data-node="0"></div>
                <div class="node" style="left: 480px; top: 590px;" data-region="gyeongsang" data-node="1"></div>
                <div class="node" style="left: 540px; top: 600px;" data-region="gyeongsang" data-node="2"></div>
                <div class="node" style="left: 460px; top: 620px;" data-region="gyeongsang" data-node="3"></div>
                <div class="node" style="left: 560px; top: 640px;" data-region="gyeongsang" data-node="4"></div>
                
                <!-- ì§€ì—­ ë¼ë²¨ë“¤ - ë™ì¼í•œ í¬ê¸° ë°°ì¹˜ì— ë§ê²Œ ì¡°ì • -->
                <div class="region-label" style="top: 420px; left: 500px;">
                    ì„œìš¸íŠ¹ë³„ì‹œ<br>
                    <span style="font-size: 12px;">Shard #1</span>
                    <span class="status-indicator status-idle"></span>
                </div>
                
                <div class="region-label" style="top: 220px; left: 250px;">
                    ê²½ê¸°ë„<br>
                    <span style="font-size: 12px;">Shard #2</span>
                    <span class="status-indicator status-idle"></span>
                </div>
                
                <div class="region-label" style="top: 220px; left: 500px;">
                    ê°•ì›íŠ¹ë³„ìì¹˜ë„<br>
                    <span style="font-size: 12px;">Shard #3</span>
                    <span class="status-indicator status-idle"></span>
                </div>
                
                <div class="region-label" style="top: 420px; left: 250px;">
                    ì¶©ì²­ë„<br>
                    <span style="font-size: 12px;">Shard #4</span>
                    <span class="status-indicator status-idle"></span>
                </div>
                
                <div class="region-label" style="top: 620px; left: 500px;">
                    ê²½ìƒë„<br>
                    <span style="font-size: 12px;">Shard #5</span>
                    <span class="status-indicator status-idle"></span>
                </div>
                
                <div class="region-label" style="top: 620px; left: 250px;">
                    ì „ë¼ë„<br>
                    <span style="font-size: 12px;">Shard #6</span>
                    <span class="status-indicator status-idle"></span>
                </div>
            </div>
        </div>
        
        <div class="info-panel">
            <h3 style="margin-top: 0;">ì‹¤ì‹œê°„ í†µê³„</h3>
            <div class="info-item">
                <span>ì´ ê±°ë˜ ìˆ˜:</span>
                <span id="totalTx">0</span>
            </div>
            <div class="info-item">
                <span>í¬ë¡œìŠ¤ ìƒ¤ë“œ ê±°ë˜:</span>
                <span id="crossShardTx">0</span>
            </div>
            <div class="info-item">
                <span>TPS (ì´ˆë‹¹ ê±°ë˜):</span>
                <span id="tps">0</span>
            </div>
            <div class="info-item">
                <span>í™œì„± ìƒ¤ë“œ:</span>
                <span id="activeShards">0/6</span>
            </div>
            <div class="info-item">
                <span>ë„¤íŠ¸ì›Œí¬ ìƒíƒœ:</span>
                <span id="networkStatus">ìë™ ì‹¤í–‰ ì¤‘</span>
            </div>
        </div>
    </div>

    <script>
        // ì „ì—­ ë³€ìˆ˜
        let totalTransactions = 0;
        let crossShardTransactions = 0;
        let transactionInterval = null;
        let isRunning = false;
        let tpsCounter = 0;
        let tpsInterval = null;

        const regionNames = ['seoul', 'gyeonggi', 'gangwon', 'chungcheong', 'gyeongsang', 'jeolla'];

        // ì§€ì—­ë³„ ê²½ê³„ ì •ë³´ - ë™ì¼í•œ í¬ê¸°ë¡œ ì—…ë°ì´íŠ¸
        const regionBoundaries = {
            gyeonggi: {x: 150, y: 150, width: 200, height: 150},
            gangwon: {x: 400, y: 150, width: 200, height: 150},
            chungcheong: {x: 150, y: 350, width: 200, height: 150},
            seoul: {x: 400, y: 350, width: 200, height: 150},
            jeolla: {x: 150, y: 550, width: 200, height: 150},
            gyeongsang: {x: 400, y: 550, width: 200, height: 150}
        };

        // ì§€ì—­ë³„ ë‚´ë¶€ ê±°ë˜ì ë“¤ - ìƒˆë¡œìš´ ë ˆì´ì•„ì›ƒì— ë§ê²Œ ì¡°ì •
        const regionNodes = {
            seoul: [
                {x: 420, y: 380, name: 'ê°•ë‚¨êµ¬'},
                {x: 480, y: 390, name: 'ì¢…ë¡œêµ¬'},
                {x: 530, y: 410, name: 'ë§ˆí¬êµ¬'},
                {x: 450, y: 440, name: 'ì˜ë“±í¬êµ¬'}
            ],
            gyeonggi: [
                {x: 170, y: 180, name: 'ìˆ˜ì›ì‹œ'},
                {x: 220, y: 170, name: 'ì„±ë‚¨ì‹œ'},
                {x: 280, y: 190, name: 'ì•ˆì–‘ì‹œ'},
                {x: 240, y: 220, name: 'ê³ ì–‘ì‹œ'},
                {x: 310, y: 240, name: 'ìš©ì¸ì‹œ'}
            ],
            gangwon: [
                {x: 420, y: 180, name: 'ì¶˜ì²œì‹œ'},
                {x: 480, y: 190, name: 'ì›ì£¼ì‹œ'},
                {x: 540, y: 200, name: 'ê°•ë¦‰ì‹œ'},
                {x: 560, y: 230, name: 'ì†ì´ˆì‹œ'},
                {x: 500, y: 250, name: 'ë™í•´ì‹œ'}
            ],
            chungcheong: [
                {x: 170, y: 380, name: 'ëŒ€ì „ì‹œ'},
                {x: 220, y: 390, name: 'ì²­ì£¼ì‹œ'},
                {x: 180, y: 420, name: 'ì²œì•ˆì‹œ'},
                {x: 280, y: 440, name: 'ì¶©ì£¼ì‹œ'}
            ],
            gyeongsang: [
                {x: 420, y: 580, name: 'ëŒ€êµ¬ì‹œ'},
                {x: 480, y: 590, name: 'ë¶€ì‚°ì‹œ'},
                {x: 540, y: 600, name: 'ìš¸ì‚°ì‹œ'},
                {x: 460, y: 620, name: 'ê²½ì£¼ì‹œ'},
                {x: 560, y: 640, name: 'ì°½ì›ì‹œ'}
            ],
            jeolla: [
                {x: 170, y: 580, name: 'ê´‘ì£¼ì‹œ'},
                {x: 220, y: 590, name: 'ì „ì£¼ì‹œ'},
                {x: 180, y: 620, name: 'ëª©í¬ì‹œ'},
                {x: 280, y: 640, name: 'ìˆœì²œì‹œ'}
            ]
        };

        // ëœë¤ ì§€ì—­ ì„ íƒ
        function getRandomRegion() {
            return regionNames[Math.floor(Math.random() * regionNames.length)];
        }

        // ëœë¤ ì§€ì—­ì˜ ëœë¤ ë…¸ë“œ ì„ íƒ
        function getRandomNode(regionName) {
            const nodes = regionNodes[regionName];
            return nodes[Math.floor(Math.random() * nodes.length)];
        }

        // ì§€ì—­ ìƒíƒœ ë³€ê²½
        function setRegionStatus(regionName, status) {
            const region = document.querySelector(`[data-region="${regionName}"]`);
            
            if (!region) return;
            
            // SVG ìš”ì†Œ ìƒíƒœ ë³€ê²½
            region.classList.remove('processing', 'active');
            if (status === 'processing') {
                region.classList.add('processing');
            } else if (status === 'active') {
                region.classList.add('active');
            }
            
            // ë¼ë²¨ì˜ ìƒíƒœ í‘œì‹œê¸° ë³€ê²½
            const indicators = document.querySelectorAll('.status-indicator');
            const regionIndex = regionNames.indexOf(regionName);
            if (indicators[regionIndex]) {
                indicators[regionIndex].className = `status-indicator status-${status}`;
            }
        }

        // í†µê³„ ì—…ë°ì´íŠ¸
        function updateStats() {
            document.getElementById('totalTx').textContent = totalTransactions;
            document.getElementById('crossShardTx').textContent = crossShardTransactions;
            document.getElementById('tps').textContent = tpsCounter;
            
            const activeCount = document.querySelectorAll('.status-active, .status-processing').length;
            document.getElementById('activeShards').textContent = `${activeCount}/6`;
            
            document.getElementById('networkStatus').textContent = 
                isRunning ? 'ì‹¤ì‹œê°„ ì²˜ë¦¬ ì¤‘' : 'ëŒ€ê¸° ì¤‘';
        }

        // TPS ê³„ì‚°
        function startTpsCounter() {
            if (tpsInterval) clearInterval(tpsInterval);
            tpsInterval = setInterval(() => {
                tpsCounter = 0;
            }, 1000);
        }

        // ì„ ë¶„ì´ ì§€ì—­ ê²½ê³„ë¥¼ ë²—ì–´ë‚˜ëŠ”ì§€ í™•ì¸í•˜ê³  ì¡°ì •
        function clipLineToRegion(regionName, fromNode, toNode) {
            const boundary = regionBoundaries[regionName];
            if (!boundary) return {from: fromNode, to: toNode};

            const minX = boundary.x + 10;
            const maxX = boundary.x + boundary.width - 10;
            const minY = boundary.y + 10;
            const maxY = boundary.y + boundary.height - 10;

            const clippedFrom = {
                x: Math.max(minX, Math.min(maxX, fromNode.x)),
                y: Math.max(minY, Math.min(maxY, fromNode.y)),
                name: fromNode.name
            };

            const clippedTo = {
                x: Math.max(minX, Math.min(maxX, toNode.x)),
                y: Math.max(minY, Math.min(maxY, toNode.y)),
                name: toNode.name
            };

            return {from: clippedFrom, to: clippedTo};
        }

        // í¬ë¡œìŠ¤ ìƒ¤ë“œ ê±°ë˜ì˜ ì ‘ì  ê³„ì‚°
        function getRegionConnectionPoint(fromRegion, toRegion) {
            const fromBoundary = regionBoundaries[fromRegion];
            const toBoundary = regionBoundaries[toRegion];
            
            if (!fromBoundary || !toBoundary) return null;

            const fromCenter = {
                x: fromBoundary.x + fromBoundary.width / 2,
                y: fromBoundary.y + fromBoundary.height / 2
            };
            const toCenter = {
                x: toBoundary.x + toBoundary.width / 2,
                y: toBoundary.y + toBoundary.height / 2
            };

            function getEdgePoint(boundary, targetCenter) {
                const centerX = boundary.x + boundary.width / 2;
                const centerY = boundary.y + boundary.height / 2;
                
                const dx = targetCenter.x - centerX;
                const dy = targetCenter.y - centerY;
                
                const ratioX = Math.abs(dx) / (boundary.width / 2);
                const ratioY = Math.abs(dy) / (boundary.height / 2);
                
                if (ratioX > ratioY) {
                    return {
                        x: centerX + (dx > 0 ? boundary.width / 2 : -boundary.width / 2),
                        y: centerY + dy * (boundary.width / 2) / Math.abs(dx)
                    };
                } else {
                    return {
                        x: centerX + dx * (boundary.height / 2) / Math.abs(dy),
                        y: centerY + (dy > 0 ? boundary.height / 2 : -boundary.height / 2)
                    };
                }
            }

            return {
                from: getEdgePoint(fromBoundary, toCenter),
                to: getEdgePoint(toBoundary, fromCenter)
            };
        }

        // ë…¸ë“œ ìƒíƒœ ë³€ê²½
        function setNodeStatus(regionName, nodeIndex, status) {
            const node = document.querySelector(`[data-region="${regionName}"][data-node="${nodeIndex}"]`);
            if (!node) return;
            
            node.classList.remove('active', 'processing');
            if (status !== 'idle') {
                node.classList.add(status);
            }
        }

        // ì§€ì—­ í™œë™ í‘œì‹œ
        function setRegionActivity(regionName, active) {
            const activityElements = document.querySelectorAll('.region-activity');
            const regionIndex = regionNames.indexOf(regionName);
            
            if (activityElements[regionIndex]) {
                if (active) {
                    activityElements[regionIndex].classList.add('active');
                } else {
                    activityElements[regionIndex].classList.remove('active');
                }
            }
        }

        // ì§€ì—­ ë‚´ ë‹¤ì¤‘ ë…¸ë“œ í™œì„±í™”
        function activateRandomNodes(regionName, count = 2) {
            const nodeCount = regionNodes[regionName].length;
            const selectedNodes = [];
            
            while (selectedNodes.length < Math.min(count, nodeCount)) {
                const randomIndex = Math.floor(Math.random() * nodeCount);
                if (!selectedNodes.includes(randomIndex)) {
                    selectedNodes.push(randomIndex);
                }
            }
            
            selectedNodes.forEach((nodeIndex, i) => {
                setTimeout(() => {
                    setNodeStatus(regionName, nodeIndex, 'processing');
                    
                    setTimeout(() => {
                        setNodeStatus(regionName, nodeIndex, 'active');
                        
                        setTimeout(() => {
                            setNodeStatus(regionName, nodeIndex, 'idle');
                        }, 800);
                    }, 300 + i * 100);
                }, i * 200);
            });
            
            setRegionActivity(regionName, true);
            setTimeout(() => {
                setRegionActivity(regionName, false);
            }, 2000);
        }

        // ì§€ì—­ ë‚´ ê±°ë˜ì„  ìƒì„±
        function createIntraShardLine(regionName, fromNode, toNode) {
            const clippedLine = clipLineToRegion(regionName, fromNode, toNode);
            const from = clippedLine.from;
            const to = clippedLine.to;
            
            const line = document.createElement('div');
            line.className = 'transaction-line';
            line.style.background = 'linear-gradient(90deg, transparent, #00ff88, #00ff88, transparent)';
            line.style.height = '2px';
            line.style.zIndex = '10';
            line.style.opacity = '0.8';
            
            const length = Math.sqrt(
                Math.pow(to.x - from.x, 2) + 
                Math.pow(to.y - from.y, 2)
            );
            const angle = Math.atan2(
                to.y - from.y, 
                to.x - from.x
            ) * 180 / Math.PI;

            line.style.width = length + 'px';
            line.style.left = from.x + 'px';
            line.style.top = from.y + 'px';
            line.style.transform = `rotate(${angle}deg)`;
            line.style.transformOrigin = '0 50%';

            document.querySelector('.korea-map-container').appendChild(line);

            setTimeout(() => {
                if (line.parentNode) {
                    line.parentNode.removeChild(line);
                }
            }, 1200);
        }

        // ì§€ì—­ ë‚´ ìë™ ê±°ë˜ ìƒì„±
        function generateIntraRegionActivity(regionName) {
            const transactionCount = Math.floor(Math.random() * 3) + 1;
            
            for (let i = 0; i < transactionCount; i++) {
                setTimeout(() => {
                    const fromNode = getRandomNode(regionName);
                    let toNode = getRandomNode(regionName);
                    
                    while (fromNode === toNode && regionNodes[regionName].length > 1) {
                        toNode = getRandomNode(regionName);
                    }
                    
                    createIntraShardLine(regionName, fromNode, toNode);
                }, i * 300);
            }
            
            activateRandomNodes(regionName, transactionCount + 1);
        }

        // ì§€ì—­ ê°„ ê±°ë˜ì„  ìƒì„±
        function createCrossShardLine(fromRegion, toRegion) {
            const connectionPoints = getRegionConnectionPoint(fromRegion, toRegion);
            if (!connectionPoints) return;

            const line = document.createElement('div');
            line.className = 'transaction-line';
            line.style.background = 'linear-gradient(90deg, transparent, #ff6b6b, #ff6b6b, transparent)';
            line.style.height = '4px';
            line.style.boxShadow = '0 0 8px #ff6b6b';
            line.style.zIndex = '8';
            
            const length = Math.sqrt(
                Math.pow(connectionPoints.to.x - connectionPoints.from.x, 2) + 
                Math.pow(connectionPoints.to.y - connectionPoints.from.y, 2)
            );
            const angle = Math.atan2(
                connectionPoints.to.y - connectionPoints.from.y, 
                connectionPoints.to.x - connectionPoints.from.x
            ) * 180 / Math.PI;

            line.style.width = length + 'px';
            line.style.left = connectionPoints.from.x + 'px';
            line.style.top = connectionPoints.from.y + 'px';
            line.style.transform = `rotate(${angle}deg)`;
            line.style.transformOrigin = '0 50%';

            document.querySelector('.korea-map-container').appendChild(line);

            setTimeout(() => {
                if (line.parentNode) {
                    line.parentNode.removeChild(line);
                }
            }, 2500);
        }

        // ê±°ë˜ ì²˜ë¦¬
        function processTransaction() {
            const fromRegion = getRandomRegion();
            let toRegion = getRandomRegion();
            
            const isLocalTransaction = Math.random() < 0.8;
            
            if (isLocalTransaction || fromRegion === toRegion) {
                generateIntraRegionActivity(fromRegion);
                
                setRegionStatus(fromRegion, 'active');
                setTimeout(() => {
                    setRegionStatus(fromRegion, 'idle');
                }, 2000);
                
                totalTransactions++;
            } else {
                if (Math.random() < 0.5) {
                    fromRegion = 'seoul';
                    toRegion = 'gangwon';
                } else {
                    do {
                        toRegion = getRandomRegion();
                    } while (fromRegion === toRegion);
                }
                
                createCrossShardLine(fromRegion, toRegion);
                
                setRegionStatus(fromRegion, 'processing');
                setRegionStatus(toRegion, 'processing');
                
                setTimeout(() => {
                    setRegionStatus(fromRegion, 'active');
                    setRegionStatus(toRegion, 'active');
                    
                    setTimeout(() => {
                        setRegionStatus(fromRegion, 'idle');
                        setRegionStatus(toRegion, 'idle');
                    }, 1500);
                }, 700);
                
                totalTransactions++;
                crossShardTransactions++;
            }

            tpsCounter++;
            updateStats();
        }

        // ìë™ ê±°ë˜ ì‹œì‘
        function startAutoTransactions() {
            if (transactionInterval) return;
            
            isRunning = true;
            startTpsCounter();
            
            transactionInterval = setInterval(() => {
                processTransaction();
            }, 500 + Math.random() * 500);
            
            updateStats();
        }

        // ì§€ì—­ í´ë¦­ ì´ë²¤íŠ¸
        document.querySelectorAll('.region').forEach(region => {
            region.addEventListener('click', () => {
                const regionName = region.dataset.region;
                
                generateIntraRegionActivity(regionName);
                
                setRegionStatus(regionName, 'active');
                setTimeout(() => {
                    setRegionStatus(regionName, 'idle');
                }, 2000);
                
                totalTransactions++;
                updateStats();
            });
        });

        // ì´ˆê¸°í™” ë° ì¦‰ì‹œ ìë™ ì‹œì‘
        updateStats();
        startAutoTransactions();
        
        // ì´ˆê¸° ì„œìš¸â†’ê°•ì›ë„ í¬ë¡œìŠ¤ìƒ¤ë“œ ë°ëª¨
        setTimeout(() => {
            createCrossShardLine('seoul', 'gangwon');
            setRegionStatus('seoul', 'processing');
            setRegionStatus('gangwon', 'processing');
            
            setTimeout(() => {
                setRegionStatus('seoul', 'active');
                setRegionStatus('gangwon', 'active');
                
                setTimeout(() => {
                    setRegionStatus('seoul', 'idle');
                    setRegionStatus('gangwon', 'idle');
                }, 1500);
            }, 700);
            
            totalTransactions++;
            crossShardTransactions++;
            updateStats();
        }, 500);
    </script>
</body>
</html>
